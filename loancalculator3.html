<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="loancalc-styles.css">
    <link href='https://fonts.googleapis.com/css?family=Open Sans' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

</head>

<body>
    <div class="container">
        <div>
            <div class="businessCalcDiv">
                <h1 class="text-center">Commercial Vehicle/Hire Purchase Loan Calculator
                </h1>
                <div class="row pt-2 pt-lg-4">
                    <div class="input-left col-lg-6 pb-4 pb-lg-0 mx-2 mx-lg-0">

                        <form class="inputForm" name="formLoanCalculate1">
                            <div class="form-group pb-0 mb-0">
                                <div class="d-flex justify-content-between">
                                    <label for="purchasePriceInput" class="inline">Loan Amount</label>
                                    <span class="inline">$<input type="text" id="purchasePriceInput"
                                            class="inline numericOnly validateInput clickEvent allCalcInput"
                                            name="purchasePriceInput" value="80,000"></span>
                                </div>
                                <p id="errorMsg1" class="allErrorMsg mt-0 mb-3"></p>
                            </div>

                            <div class="form-group pb-0 mb-0">
                                <div class="d-flex justify-content-between">
                                    <label for="downPaymentInput" class="inline">Down Payment</label>
                                    <span class="inline">$<input type="text" id="downPaymentInput"
                                            class="inline numericOnly validateInput clickEvent allCalcInput"
                                            name="downPaymentInput" value="0"></span>
                                </div>
                                <p id="errorMsg2" class="allErrorMsg mt-0 mb-3"></p>

                            </div>
                            <div class="form-group py-0">
                                <div class="d-flex justify-content-between">
                                    <label for="interestRateInput" class="inline">Interest Rate</label><span
                                        class="inline">
                                        <input type="text" id="interestRateInput" name="interestRateInput"
                                            class="inline numericDecOnly validateInput clickEvent allCalcInput ">%</span>
                                </div>
                                <div class="slider-container">
                                    <span class="bar interest-bar"><span class="fill"></span></span>
                                    <input type="range" min="0" max="5" step="0.01" class="slider" value="2.5"
                                        id="interestRateRange">
                                </div>
                                <p id="errorMsg3" class="allErrorMsg"></p>

                            </div>

                            <div class="form-group py-0">
                                <div class="d-flex justify-content-between">
                                    <label for="tenureInput" class="inline">Loan Tenure</label>
                                    <span class="inline"><input type="text" id="tenureInput"
                                            class="inline numericOnly7 clickEvent allCalcInput">year(s)
                                    </span>
                                </div>

                                <div class="slider-container">
                                    <span class="bar tenure-bar"><span class="fill"></span></span>
                                    <input type="range" min="1" max="7" step="1" class="slider" id="tenureRange"
                                        value="3.5">
                                </div>
                                <p id="errorMsg4" class="allErrorMsg"></p>
                            </div>
                        </form>
                        <button onclick="calculateFunction()" id="calculateBtn"
                            class="btn btn-calculate btnCalculate mx-auto d-block" type="button">Calculate</button>
                    </div>

                    <div class="h-auto align-self-center result-right col-lg-6 text-center mt-4 mt-lg-0">
                        <h1 id="amount" class="result beforeCalculate">Repayment Summary</h1>
                        <p class="beforeCalculate font-italic">Please enter the information to
                            continue.</p>
                        <div class="result afterCalculate" id="result">
                            <h1 class="font-weight-bold">The loan amount is
                            </h1>
                            <h1 id="loanAmtDisplay" class=" font-weight-bold"></h1>
                            <p id="interestRateDisplay" class="font-italic">
                            </p>
                            <h1 class="font-weight-bold">There would be an estimate repayment of</h1>
                            <h1 id="monthlyAmtDisplay" class="font-weight-bold"></h1>
                            <p class="font-italic">To assist you in your planning, we are pleased to provide you with a loan repayment
                                schedule for your Commercial Vehicle or Machinery & Equipment Financing needs. For more
                                details, visit any of our UOB branches or <a
                                    href="https://uniservices1.uobgroup.com/appforms/business/UOB_Call_Back_Request.page?ProdName=Vehicle-and-Machinery-Financing">request
                                    a callback</a> from us.
                            </p>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</body>
<link rel="stylesheet" href="loancalc-styles.css">
<script>
    $(document).ready(function () {
        displayOutput()

        //prevents user from entering anything other than . and numbers
        $(".numericOnly").keypress(function (e) {

            if (String.fromCharCode(e.keyCode).match(/[^0-9]/g)) return false;

        });

        $(".numericDecOnly").keypress(function (e) {

            // if (String.fromCharCode(e.keyCode).match(/[0-9]+(\.[0-9][0-9]?)?/g)) return true;
            if (String.fromCharCode(e.keyCode).match(/[^0-9.]/g)) return false;

            var character = String.fromCharCode(e.keyCode)
            var newValue = this.value + character;

            if (isNaN(newValue) || hasDecimalPlace(newValue, 3)) {
                return false;
            }
            // if (newValue > 20) {
            //     $("#errorMsg3").text("Value cannot be more than 20!")
            //     this.value = 20
            //     return false;
            // }
        });

        $(".numericOnly7").keypress(function (e) {
            if (String.fromCharCode(e.keyCode).match(/[^1-7]/g)) return false;

            // only allows 1 digit numbers
            var strNum = Math.ceil(Math.log10(document.getElementById("tenureInput").value + 1))

            if (strNum > 0) {
                console.log("longgg")
                return false
            }

        });

        //event to bind validate function with input, this validate input and disables button if invalid
        //everytime user types it will validate current input field, showing error msg immediately as user types
        $("input.clickEvent:text").on("change paste keyup", function () {
            validateFunction()
            console.log("change paste keyup")
            setbar();
        });


        //to clear input upon clicking the input box and put default if user leave input blank
        var default_val = '';
        $('input.clickEvent:text').focus(function () {
            if ($(this).val() == $(this).data('default_val') || !$(this).data('default_val')) {
                $(this).data('default_val', $(this).val());
                $(this).val('');
            }
            validateFunction()
        });

        $('input.clickEvent:text').blur(function () {
            if ($(this).val() == '') $(this).val($(this).data('default_val'));
            validateFunction()

        });

    });

    // call function to display the indicator for the slider


    document.getElementById("interestRateRange").oninput = function () {
        // displayOutput()
        var val2 = document.getElementById("interestRateRange").value //gets the oninput value
        document.getElementById("interestRateInput").value = val2//displays this value to the html page
        validateFunction()
        // $("#errorMsg3").text("")


    }

    document.getElementById("tenureRange").oninput = function () {
        var val3 = document.getElementById("tenureRange").value //gets the oninput value
        document.getElementById("tenureInput").value = val3 //displays this value to the html page
        validateFunction()


    }

    //function to display the indicator in the input box for the slider

    function displayOutput() {

        var val2 = document.getElementById("interestRateRange").value //gets the oninput value
        document.getElementById("interestRateInput").value = val2//displays this value to the html page

        var val3 = document.getElementById("tenureRange").value //gets the oninput value
        document.getElementById("tenureInput").value = val3 //displays this value to the html page
    }

    // validate input
    function validateFunction() {

        var a = parseInt(removeCommas(document.getElementById("purchasePriceInput").value))
        var b = parseInt(removeCommas(document.getElementById("downPaymentInput").value))
        var c = parseFloat(document.getElementById("interestRateInput").value)
        var d = parseInt(document.getElementById("tenureInput").value)
        // var regexp = /^\d+\.\d{0,2}$/;

        var array = [
            {
                name: "loanAmt",
                value: a
            },
            {
                name: "downPayment",
                value: b
            },
            {
                name: "interestRate",
                value: c
            }, {
                name: "tenure",
                value: d
            }]

        var trueFalseArr = []

        $.each(array, function (index, element) {

            if (array[index].name == "loanAmt") {
                if (isNaN(array[index].value)) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg1").text("Value is not a number")
                }
                else if (array[index].value < 5000) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg1").text("Value cannot be less than 5,000")
                }
                else if (array[index].value > 500000) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg1").text("Value cannot be more than 500,000")
                }


                else {
                    $("#errorMsg1").text("")
                    trueFalseArr.push("true")
                }


            }
            else if (array[index].name == "downPayment") {
                if (isNaN(array[index].value)) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg2").text("Value is not a number")
                }

                else if (array[index].value < 0) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg2").text("Value cannot be less than 0")
                }

                else if (array[index].value > 500000) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg2").text("Value cannot be more than $500,000")
                }
                else {
                    $("#errorMsg2").text("")
                    trueFalseArr.push("true")
                }
            }


            else if (array[index].name == "interestRate") {
                // console.log("b")
                // console.log(array[index].value)
                if (isNaN(array[index].value)) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg3").text("Value is not a number")
                }

                else if (array[index].value < 0) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg3").text("Value cannot be less than 0")
                }

                else if (array[index].value > 5) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg3").text("Value cannot be more than 5")
                }
                else {
                    $("#errorMsg3").text("")
                    trueFalseArr.push("true")
                    $("#interestRateRange").val(c)
                }

            }
            else if (array[index].name == "tenure") {
                // console.log("c")
                // console.log(array[index].value)
                if (isNaN(array[index].value)) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg4").text("Value is not a number")
                }

                else if (array[index].value < 1) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg4").text("Value cannot be less than 1")
                }

                else if (array[index].value > 7) {
                    $("#calculateBtn").attr("disabled", true);
                    $("#errorMsg4").text("Value cannot be more than 7")
                }
                else {
                    $("#errorMsg4").text("")
                    trueFalseArr.push("true")
                    $("#tenureRange").val(d)

                }

            }

        })


        if (trueFalseArr.length == 4) {

            $("#calculateBtn").attr("disabled", false);

            // $("#interestRateRange").val(c)
            // $("#tenureRange").val(d)

        }


    }

    //to calculate the monthly loan payment
    function calculateFunction() {
        $(".beforeCalculate").hide()
        $(".afterCalculate").show()
        var p = parseInt(removeCommas(document.getElementById("purchasePriceInput").value));
        var d = parseInt(removeCommas(document.getElementById("downPaymentInput").value));
        var t = parseFloat(document.getElementById("interestRateInput").value);
        var y = parseInt(document.getElementById("tenureInput").value);

        var totalAmt = p - d
        var int = t / 100
        var months = y * 12
        var monthlyAmt = (totalAmt * (1 + int)) / months

        document.getElementById("loanAmtDisplay").innerHTML = '<span class="calcResult">$' + addCommas(Math.round(totalAmt)) + '</span>';
        document.getElementById("interestRateDisplay").innerHTML = "(Effective Interest Rate of " + t + "% p.a)"
        document.getElementById("monthlyAmtDisplay").innerHTML = '<span class="calcResult">$' + addCommas(Math.round(monthlyAmt)) + "</span>/month"

    }
    // add commas after every 3 digit from the decimal place
    function addCommas(x) {
        return x.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
    }
    //remove commas so that it can be inserted into the calculate function
    function removeCommas(str) {
        while (str.search(",") >= 0) {
            str = (str + "").replace(',', '');
        }
        return str;
    };

    //ensures that interest rate does not exceed two decimal place
    function hasDecimalPlace(value, x) {
        var pointIndex = value.indexOf('.');
        return pointIndex >= 0 && pointIndex < value.length - x;
    }


    //script for range slider (make progress bar move with the thumb)
    // var progressBar = $(".bar .fill");
    var slider = $(".slider");
    var interestSlider = $("#interestRateRange");
    var tenureSlider = $("#tenureRange")
    var interestProgressBar = $(".bar.interest-bar .fill");
    var tenureProgressBar = $(".bar.tenure-bar .fill");

    function setbar() {
        // progressBar.css('width', slider.val() + "%");
        interestProgressBar.css('width', interestSlider.val() * 20 + "%");

        if (tenureSlider.val() == "1") {
            tenureProgressBar.css('width', 0 + "%");
        } else if (tenureSlider.val() == "2") {
            tenureProgressBar.css('width', 16.67 + "%");
        } else if (tenureSlider.val() == "3") {
            tenureProgressBar.css('width', 33.33 + "%");
        } else if (tenureSlider.val() == "4") {
            tenureProgressBar.css('width', 50 + "%");
        } else if (tenureSlider.val() == "5") {
            tenureProgressBar.css('width', 66.67 + "%");
        } else if (tenureSlider.val() == "6") {
            tenureProgressBar.css('width', 83.34 + "%");
        } else if (tenureSlider.val() == "7") {
            tenureProgressBar.css('width', 100 + "%");
        }

    }

    slider.on("input", setbar);
    setbar();


</script>

</html>